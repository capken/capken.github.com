<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>WeChat</title>
</head>
<body>
  <script>
    function getQueryStringValue (key) {  
      return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
    }

    var accessToken = getQueryStringValue('access_token');
    if (accessToken === '') {
      var callbackUrl = window.location.href;
      var authUrl = "http://www.cutexbb.com/wechat/auth?type=BASE&state=" + encodeURI(callbackUrl);
      window.location.href = authUrl;
    } else {
      sessionStorage.setItem('accessToken', accessToken);
      sessionStorage.setItem('openId', getQueryStringValue('openid'));
      var url = window.location.href;
      var appHomeUrl = url.replace(/wechat\.html.*$/, 'index.html');
      window.location.href = appHomeUrl;
    }
  </script>
</body>
</html>
